import{n as ee,r as q,p as oe,a1 as le,a2 as re,c as X,h as ce,B as ue,g as ie,d as T,X as D,o as Z,l as u,m as C,x as t,a3 as de,f as e,q as z,a4 as E,t as G,u as P,a5 as O,A as V,z as S,a6 as w,F,Z as H,v as J,_ as W,a7 as me,Q as L,R as te,a8 as se,a9 as _e}from"./index.737d3221.js";import{Q as N,a as b,b as x,c as I}from"./friends-store.63435914.js";import{h as g,u as ae}from"./auth-store.79001c12.js";import{u as fe}from"./use-quasar.8362b04f.js";import{u as j}from"./account-store.93e228d8.js";import{g as ke,a as pe}from"./dates.89413a91.js";class ge{getPosts(){return g.get("posts")}getPost(n){return g.get(`posts/${n}`)}getFriendsPosts(){return g.get("posts/friends")}getUserPosts(n){return g.get(`posts/users/${n}`)}createPost(n){return g.post("posts",{content:n})}likePost(n){return g.post("posts/likes/like",{postId:n})}unlikePost(n){return g.post("posts/likes/unlike",{postId:n})}getLikes(n){return g.get(`posts/likes/${n}`)}}const $=new ge,K=ee("posts",()=>{const a=q([]);async function n(){const s=await $.getFriendsPosts();return a.value=s.data,s.data}async function m(){const s=await $.getPosts();return a.value=s.data.posts,s.data.posts}async function f(s){const c=await $.getUserPosts(s);return a.value=c.data.posts,c.data.posts}async function v(s){await $.getPost(s)}async function y(s){var p;const c=await $.createPost(s);(p=a.value)==null||p.push(c.data)}async function k(s){return console.log(s),await $.likePost(s)}async function _(s){return console.log(s),await $.unlikePost(s)}async function r(s){return await $.getLikes(s)}return{posts:a,getPosts:m,getPost:v,getFriendsPosts:n,getUserPosts:f,createPost:y,likePost:k,unlikePost:_,getLikes:r}}),ve=["text","rect","circle","QBtn","QBadge","QChip","QToolbar","QCheckbox","QRadio","QToggle","QSlider","QRange","QInput","QAvatar"],ye=["wave","pulse","pulse-x","pulse-y","fade","blink","none"];var Q=oe({name:"QSkeleton",props:{...le,tag:{type:String,default:"div"},type:{type:String,validator:a=>ve.includes(a),default:"rect"},animation:{type:String,validator:a=>ye.includes(a),default:"wave"},animationSpeed:{type:[String,Number],default:1500},square:Boolean,bordered:Boolean,size:String,width:String,height:String},setup(a,{slots:n}){const m=ie(),f=re(a,m.proxy.$q),v=X(()=>{const k=a.size!==void 0?[a.size,a.size]:[a.width,a.height];return{"--q-skeleton-speed":`${a.animationSpeed}ms`,width:k[0],height:k[1]}}),y=X(()=>`q-skeleton q-skeleton--${f.value===!0?"dark":"light"} q-skeleton--type-${a.type}`+(a.animation!=="none"?` q-skeleton--anim q-skeleton--anim-${a.animation}`:"")+(a.square===!0?" q-skeleton--square":"")+(a.bordered===!0?" q-skeleton--bordered":""));return()=>ce(a.tag,{class:y.value,style:v.value},ue(n.default))}});const he=["src"],Ce=T({__name:"LikesDialog",props:["isLikesDialog","likes","id"],setup(a){const n=K(),{getLikes:m}=n,f=a,v=q(f.isLikesDialog),y=j(),{addAccounts:k}=y,{accountsMap:_}=D(y);return Z(async()=>{try{const r=await m(f.id);k(r.data.accountsMap)}catch{}}),(r,s)=>(u(),C(de,{modelValue:v.value,"onUpdate:modelValue":s[0]||(s[0]=c=>v.value=c),position:"right"},{default:t(()=>[e(H,{class:"card-container"},{default:t(()=>[(u(!0),z(F,null,E(a.likes,c=>(u(),C(N,{key:c},{default:t(()=>[G((u(),C(b,{clickable:""},{default:t(()=>[e(x,{side:""},{default:t(()=>[P(_)[c]?(u(),C(O,{key:0,size:"64px"},{default:t(()=>{var p;return[V("img",{src:(p=P(_)[c])==null?void 0:p.avatarUrl},null,8,he)]}),_:2},1024)):(u(),C(Q,{key:1,type:"QAvatar",size:"64px"}))]),_:2},1024),e(x,null,{default:t(()=>[e(I,null,{default:t(()=>{var p;return[S(w((p=P(_)[c])==null?void 0:p.name),1)]}),_:2},1024)]),_:2},1024)]),_:2},1024)),[[J]])]),_:2},1024))),128))]),_:1})]),_:1},8,["modelValue"]))}});var we=W(Ce,[["__scopeId","data-v-7d3ed75a"]]);class Pe{getMyComments(){return g.get("comments")}getComment(n){return g.get(`comments/${n}`)}getPostComments(n){return g.get(`comments/post/${n}`)}createComment(n,m){return g.post("comments",{content:n,commentedIn:m})}likeComment(n){return g.post("comments/likes/like",{commentId:n})}unlikeComment(n){return g.post("comments/likes/unlike",{commentId:n})}getCommentLikes(n){return g.get(`comments/likes/${n}`)}}const B=new Pe,{posts:Se}=D(K()),{addAccounts:Y,getMyAccount:xe}=j(),ne=ee("comments",()=>{const a=q([]);async function n(){return(await B.getMyComments()).data}async function m(r){const s=await B.getPostComments(r);return a.value=s.data.comments,Y(s.data.accountsMap),s.data}async function f(r){return(await B.getComment(r)).data}async function v(r,s){const c=await B.createComment(r,s);a.value.push(c.data);const p=await xe();Y({[c.data.createdBy]:p});const A=Se.value.find(M=>M._id===s);return A&&A.commentsLength++,c.data}async function y(r){return(await B.likeComment(r)).data}async function k(r){return(await B.unlikeComment(r)).data}async function _(r){return(await B.getCommentLikes(r)).data}return{comments:a,getMyComments:n,getPostComments:m,getComment:f,createComment:v,likeComment:y,unlikeComment:k,getCommentLikes:_}}),be=["src"],Qe=T({__name:"CommentInput",props:["postId"],setup(a){const n=j(),{currentAccount:m}=D(n),f=q(""),v=ne(),{createComment:y}=v,k=a,_=async()=>{try{await y(f.value,k.postId)&&(f.value="")}catch(r){console.log(r)}};return(r,s)=>(u(),C(N,null,{default:t(()=>[e(b,null,{default:t(()=>[e(x,{avatar:""},{default:t(()=>[e(O,{size:"56px"},{default:t(()=>{var c;return[V("img",{src:(c=P(m))==null?void 0:c.avatarUrl,alt:""},null,8,be)]}),_:1})]),_:1}),e(x,null,{default:t(()=>[e(me,{modelValue:f.value,"onUpdate:modelValue":s[0]||(s[0]=c=>f.value=c),rounded:"",outlined:"",class:"input",autogrow:"",placeholder:"Comment here",type:"text"},null,8,["modelValue"])]),_:1}),e(x,{side:""},{default:t(()=>[e(L,{onClick:_},{default:t(()=>[S("Send")]),_:1})]),_:1})]),_:1})]),_:1}))}});const $e={class:"q-ma-md"},Le=["src"],Ie=T({__name:"CommentsComponent",props:["postId"],setup(a){const n=a,m=ne(),{getPostComments:f,likeComment:v,unlikeComment:y}=m,{comments:k}=D(m),_=X(()=>k.value.slice().reverse()),r=ae(),{tokenData:s}=D(r),{currentAccount:c,accountsMap:p}=D(j()),{getMyAccount:A}=j();Z(async()=>{try{await f(n.postId),await A()}catch(i){console.log(i)}});async function M(i){var o;try{await v(i._id),(o=c.value)!=null&&o.createdBy&&i.likes.push(c.value.createdBy)}catch(l){console.log("failed to like comment",l)}}async function h(i){try{await y(i._id),i.likes.splice(i.likes.findIndex(o=>{var l;return o===((l=s.value)==null?void 0:l.userId)}),1)}catch(o){console.log("failed to unlike comment",o)}}return(i,o)=>(u(),z(F,null,[e(Qe,{postId:n.postId},null,8,["postId"]),V("div",$e,[(u(!0),z(F,null,E(_.value,l=>(u(),C(N,{key:l},{default:t(()=>{var U;return[e(b,{class:"q-mb-md",to:{name:P(te).profile,params:{id:(U=P(p)[l.createdBy])==null?void 0:U.createdBy}}},{default:t(()=>[e(x,{avatar:"",class:"self-start"},{default:t(()=>[e(O,{size:"40px"},{default:t(()=>{var d;return[V("img",{src:(d=P(p)[l==null?void 0:l.createdBy])==null?void 0:d.avatarUrl,alt:""},null,8,Le)]}),_:2},1024)]),_:2},1024),e(x,null,{default:t(()=>[e(I,{class:"row justify-between"},{default:t(()=>{var d;return[S(w((d=P(p)[l==null?void 0:l.createdBy])==null?void 0:d.name),1)]}),_:2},1024),e(I,{class:"comment-box"},{default:t(()=>[S(w(l==null?void 0:l.content),1)]),_:2},1024)]),_:2},1024),e(x,{side:"",top:""},{default:t(()=>[e(I,null,{default:t(()=>[S(w(P(ke)(l.createdAt)),1)]),_:2},1024),e(I,null,{default:t(()=>{var d;return[l.likes.includes(((d=P(s))==null?void 0:d.userId)||"")?(u(),C(L,{key:1,onClick:R=>h(l),icon:"thumb_up",round:"",flat:"",size:"12px",color:"secondary"},{default:t(()=>[S(w(l.likes.length),1)]),_:2},1032,["onClick"])):(u(),C(L,{key:0,onClick:R=>M(l),icon:"thumb_up",round:"",flat:"",size:"12px"},{default:t(()=>[S(w(l.likes.length),1)]),_:2},1032,["onClick"]))]}),_:2},1024)]),_:2},1024)]),_:2},1032,["to"])]}),_:2},1024))),128))])],64))}});var Be=W(Ie,[["__scopeId","data-v-7d351d99"]]);const qe=["src"],De={key:0},Ae=T({__name:"PostsComponent",props:["posts","accountsMap"],setup(a){const n=a,m=ae(),f=K(),{likePost:v,unlikePost:y}=f,{tokenData:k}=D(m),_=q([!1]),r=q(!1),s=q(!1),c=fe();Z(()=>{var h;_.value=Array.from({length:(h=n.posts)==null?void 0:h.length},()=>!1)});function p(h,i){r.value=!0,c.dialog({position:"right",component:we,componentProps:{isLikesDialog:r,likes:h,id:i}})}async function A(h){var i;try{s.value=!0,await v(h._id),h.likes.push((i=k.value)==null?void 0:i.userId)}catch(o){console.log("Failed to like post",o)}finally{s.value=!1}}async function M(h){try{s.value=!0,await y(h._id),h.likes.splice(h.likes.findIndex(i=>{var o;return i===((o=k.value)==null?void 0:o.userId)}),1)}catch(i){console.log("Failed to unlike post",i)}finally{s.value=!1}}return(h,i)=>(u(!0),z(F,null,E(a.posts,(o,l)=>(u(),C(H,{key:o,class:"column card-container justify-center q-ma-md"},{default:t(()=>[e(N,null,{default:t(()=>{var U;return[G((u(),C(b,{clickable:"",to:{name:P(te).profile,params:{id:(U=a.accountsMap[o.createdBy])==null?void 0:U.createdBy}}},{default:t(()=>[e(x,{side:""},{default:t(()=>[e(O,{size:"64px"},{default:t(()=>{var d;return[V("img",{src:(d=a.accountsMap[o.createdBy])==null?void 0:d.avatarUrl,alt:""},null,8,qe)]}),_:2},1024)]),_:2},1024),e(x,null,{default:t(()=>[e(I,null,{default:t(()=>{var d;return[S(w((d=a.accountsMap[o.createdBy])==null?void 0:d.name),1)]}),_:2},1024),e(I,{caption:""},{default:t(()=>[S(w(P(pe)(o.createdAt)),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["to"])),[[J]]),e(b,null,{default:t(()=>[S(w(o.content),1)]),_:2},1024),e(b,{class:"row justify-between"},{default:t(()=>[e(L,{onClick:d=>p(o.likes,o._id),flat:""},{default:t(()=>[S(w(o.likes.length)+" "+w(o.likes.length===1?"like":"likes"),1)]),_:2},1032,["onClick"]),e(L,{onClick:d=>_.value[l]=!_.value[l],flat:""},{default:t(()=>[S(w(o.commentsLength)+" "+w(o.commentsLength===1?"comment":"comments"),1)]),_:2},1032,["onClick"])]),_:2},1024),e(se),e(b,{class:"row justify-between"},{default:t(()=>{var d;return[o.likes.includes((d=P(k))==null?void 0:d.userId)?(u(),C(L,{key:1,loading:s.value,unelevated:"",onClick:R=>M(o),icon:"thumb_up",label:"Like","no-caps":"",color:"secondary"},null,8,["loading","onClick"])):(u(),C(L,{key:0,loading:s.value,unelevated:"",onClick:R=>A(o),icon:"thumb_up",label:"Like","no-caps":""},null,8,["loading","onClick"])),e(L,{unelevated:"",onClick:R=>_.value[l]=!_.value[l],icon:"chat",label:"Comment","no-caps":""},null,8,["onClick"])]}),_:2},1024)]}),_:2},1024),_.value[l]?(u(),z("div",De,[e(Be,{postId:o._id},null,8,["postId"])])):_e("",!0)]),_:2},1024))),128))}});var Te=W(Ae,[["__scopeId","data-v-3a672bb2"]]);const ze={};function Me(a,n){return u(),z(F,null,E([1,2],m=>e(H,{key:m,class:"column card-container justify-center q-ma-md"},{default:t(()=>[e(N,null,{default:t(()=>[G((u(),C(b,{clickable:""},{default:t(()=>[e(x,{side:""},{default:t(()=>[e(Q,{type:"circle",size:"64px"})]),_:1}),e(x,null,{default:t(()=>[e(Q,{width:"100px",class:"q-mb-sm"}),e(I,{caption:""},{default:t(()=>[e(Q,{width:"70px"})]),_:1})]),_:1})]),_:1})),[[J]]),e(b,null,{default:t(()=>[e(Q,{height:"50px",width:"100%"})]),_:1}),e(b,{class:"row justify-between"},{default:t(()=>[e(Q,{width:"100px"}),e(Q,{width:"100px"})]),_:1}),e(se),e(b,{class:"row justify-between"},{default:t(()=>[e(Q,{width:"100px"}),e(Q,{width:"100px"})]),_:1})]),_:1})]),_:2},1024)),64)}var Ee=W(ze,[["render",Me],["__scopeId","data-v-512c3ac4"]]);export{Te as P,Ee as a,K as u};
