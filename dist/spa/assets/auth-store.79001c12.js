var k=Object.defineProperty;var T=(r,e,t)=>e in r?k(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var p=(r,e,t)=>(T(r,typeof e!="symbol"?e+"":e,t),t);import{N as S,n as E,r as w}from"./index.737d3221.js";import{a as b}from"./axios.37d53be1.js";class I{constructor(){p(this,"service");this.service=b.create({baseURL:"http://localhost:9000/api/v1/"}),this.service.interceptors.response.use(void 0,this.errorsInterceptor)}errorsInterceptor(...e){S.create({type:"negative",textColor:"white",message:e[0].response.data.msg||"Something went wrong",icon:"warning",timeout:3e3,progress:!0})}setAuthToken(e){const t=this.service.defaults.headers.common;t.Authorization=e?`Bearer ${e}`:""}get(e,t){return this.service.get(e,t)}post(e,t,n){return this.service.post(e,t,n)}patch(e,t,n){return this.service.patch(e,t,n)}delete(e,t){return this.service.delete(e,t)}}const s=new I,h="authToken";class U{constructor(){s.setAuthToken(this.getAuthToken())}getAuthToken(){return window.localStorage.getItem(h)}setAuthToken(e){e?window.localStorage.setItem(h,e):window.localStorage.removeItem(h),s.setAuthToken(e)}async getUserEmail(){return await s.get("auth/email")}async updateUserEmail(e){return await s.patch("auth/email",{newEmail:e})}async changePassword(e){return await s.patch("auth/password",e)}async login(e){const t=await s.post("auth/login",e);return this.setAuthToken(t.data.token),t}async register(e){const t=await s.post("auth/register",e);return console.log(t),this.setAuthToken(t.data.token),t}async deleteAccount(){return await s.delete("auth/delete")}}const i=new U;function d(r){this.message=r}d.prototype=new Error,d.prototype.name="InvalidCharacterError";var f=typeof window!="undefined"&&window.atob&&window.atob.bind(window)||function(r){var e=String(r).replace(/=+$/,"");if(e.length%4==1)throw new d("'atob' failed: The string to be decoded is not correctly encoded.");for(var t,n,c=0,o=0,u="";n=e.charAt(o++);~n&&(t=c%4?64*t+n:n,c++%4)?u+=String.fromCharCode(255&t>>(-2*c&6)):0)n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(n);return u};function C(r){var e=r.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw"Illegal base64url string!"}try{return function(t){return decodeURIComponent(f(t).replace(/(.)/g,function(n,c){var o=c.charCodeAt(0).toString(16).toUpperCase();return o.length<2&&(o="0"+o),"%"+o}))}(e)}catch{return f(e)}}function l(r){this.message=r}function x(r,e){if(typeof r!="string")throw new l("Invalid token specified");var t=(e=e||{}).header===!0?0:1;try{return JSON.parse(C(r.split(".")[t]))}catch(n){throw new l("Invalid token specified: "+n.message)}}l.prototype=new Error,l.prototype.name="InvalidTokenError";const P=E("auth",()=>{const r=w(null),e=w("");t();function t(){const a=i.getAuthToken();if(a)try{r.value=x(a)}catch{r.value=null}else r.value=null}function n(){i.setAuthToken(null),r.value=null}function c(){return!!r.value&&r.value.exp*1e3>Date.now()}async function o(){try{const a=await i.getUserEmail();e.value=a.data.email}catch{e.value=""}}async function u(a){return await i.updateUserEmail(a)}async function m(a){return await i.changePassword(a)}async function v(a){console.log("login submitted");const g=await i.login(a);return t(),g}async function y(a){console.log("register submitted"),await i.register(a),t()}async function A(){return await i.deleteAccount()}return{tokenData:r,userEmail:e,login:v,register:y,isLoggedIn:c,removeAuthData:n,getUserEmail:o,updateUserEmail:u,changePassword:m,deleteAccount:A}});export{i as a,s as h,P as u};
